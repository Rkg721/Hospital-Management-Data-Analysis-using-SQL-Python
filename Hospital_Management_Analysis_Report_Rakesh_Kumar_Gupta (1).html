<html lang="en"><head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.13/html-to-image.min.js" integrity="sha512-iZ2ORl595Wx6miw+GuadDet4WQbdSWS3JLMoNfY8cRGoEFy6oT3G9IbcrBeL6AfkgpA51ETt/faX6yLV+/gFJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      (function() {
        const originalConsole = window.console;
        window.console = {
          log: (...args) => {
            originalConsole.log(...args);
            window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');
          },
          error: (...args) => {
            originalConsole.error(...args);
            window.parent.postMessage({ type: 'console', message: 'Error: ' + args.join(' ') }, '*');
          },
          warn: (...args) => {
            originalConsole.warn(...args);
            window.parent.postMessage({ type: 'console', message: 'Warning: ' + args.join(' ') }, '*');
          }
        };

        let requestId = 0;
        let callbacksMap = new Map();
        let streamControllers = new Map();
        
        window.claude = {
          complete: (prompt) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'claudeComplete', id, prompt }, '*');
            });
          }
        };

        let pendingBlobs = new Map();
        URL.createObjectURL = (blob) => {
          // Store the blob and create an ID and URL for it
          const blobId = `blob-${Date.now()}-${Math.random()}`;
          pendingBlobs.set(blobId, blob);
          return `blob-request://${blobId}`;
        };

        URL.revokeObjectURL = (url) => {
          // Remove the blob from our store
          const blobId = url.replace("blob-request://", "");
          pendingBlobs.delete(blobId);
        };

        const getBlobFromURL = (url) => {
          const blobId = url.replace("blob-request://", "");
          return pendingBlobs.get(blobId);
        };

        // Override global fetch with streaming support
        window.fetch = (url, init = {}) => {
          return new Promise((resolve, reject) => {
            const id = requestId++;
            const channelId = `fetch-${id}-${Date.now()}`;
            
            callbacksMap.set(id, { 
              resolve: (response) => {
                // Create a ReadableStream for the response body
                const stream = new ReadableStream({
                  start(controller) {
                    streamControllers.set(channelId, controller);
                  },
                  cancel() {
                    streamControllers.delete(channelId);
                  }
                });
                
                // Create and return the Response with the stream
                resolve(new Response(stream, {
                  status: response.status,
                  statusText: response.statusText,
                  headers: response.headers
                }));
              },
              reject,
              channelId
            });
            
            window.parent.postMessage({
              type: 'proxyFetch',
              id,
              url,
              init,
              channelId
            }, '*');
          });
        };

        window.addEventListener('message', async (event) => {
          if (event.data.type === 'takeScreenshot') {
            const rootElement = document.getElementById('artifacts-component-root-html');
            if (!rootElement) {
              window.parent.postMessage({
                type: 'screenshotError',
                error: new Error('Root element not found'),
              }, '*');
            }
            const screenshot = await htmlToImage.toPng(rootElement, {
              imagePlaceholder:
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII=",
            });
            window.parent.postMessage({
              type: 'screenshotData',
              data: screenshot,
            }, '*');
          } else if (event.data.type === 'claudeComplete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.completion);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'proxyFetchResponse') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
              callbacksMap.delete(event.data.id);
            } else {
              // Initial response with headers, status, etc.
              callback.resolve({
                status: event.data.status,
                statusText: event.data.statusText,
                headers: event.data.headers
              });
              // Don't delete the callback yet if streaming
              if (!event.data.body) {
                callbacksMap.delete(event.data.id);
              }
            }
          } else if (event.data.type === 'proxyFetchStream') {
            // Handle streaming data chunks
            const controller = streamControllers.get(event.data.channelId);
            if (controller) {
              if (event.data.error) {
                controller.error(new Error(event.data.error));
                streamControllers.delete(event.data.channelId);
              } else if (event.data.done) {
                controller.close();
                streamControllers.delete(event.data.channelId);
                // Clean up the callback
                const callback = Array.from(callbacksMap.entries()).find(
                  ([_, value]) => value.channelId === event.data.channelId
                );
                if (callback) {
                  callbacksMap.delete(callback[0]);
                }
              } else if (event.data.chunk) {
                controller.enqueue(new Uint8Array(event.data.chunk));
              }
            }
          }
        });

        window.addEventListener('click', (event) => {
          const isEl = event.target instanceof HTMLElement;
          if (!isEl) return;
    
          // find ancestor links
          const linkEl = event.target.closest("a");
          if (!linkEl || !linkEl.href) return;
    
          event.preventDefault();
          event.stopImmediatePropagation();
    
          if (linkEl.href.startsWith("blob-request:")) {
            const blob = getBlobFromURL(linkEl.href);
            if (!blob) return;
            void blob.arrayBuffer().then((data) => {
              window.parent.postMessage({
                type: "downloadFile",
                filename: linkEl.download,
                data,
                mimeType: blob.type || "application/octet-stream",
              });
            });
          } else if (linkEl.href.startsWith("data:")) {
            const [header, base64Data] = linkEl.href.split(",");
            const mimeMatch = header.match(/data:([^;]+)/);
            const mimeType = mimeMatch ? mimeMatch[1] : "application/octet-stream";
            const binaryString = atob(base64Data);
            const data = Uint8Array.from(binaryString, (c) =>
              c.charCodeAt(0),
            ).buffer;
            window.parent.postMessage({
              type: "downloadFile",
              filename: linkEl.download,
              data,
              mimeType,
            });
          } else {
            let linkUrl;
            try {
              linkUrl = new URL(linkEl.href);
            } catch (error) {
              return;
            }
    
            if (linkUrl.hostname === window.location.hostname) return;
      
            window.parent.postMessage({
              type: 'openExternal',
              href: linkEl.href,
            }, '*');
          }
      });

        const originalOpen = window.open;
        window.open = function (url) {
          window.parent.postMessage({
            type: "openExternal",
            href: url,
          }, "*");
        };

        window.addEventListener('error', (event) => {
          window.parent.postMessage({ type: 'console', message: 'Uncaught Error: ' + event.message }, '*');
        });
      })();
    </script>
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management Data Analysis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .author-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .author-info h3 {
            margin-bottom: 5px;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.3em;
            margin-bottom: 15px;
            margin-top: 25px;
        }
        
        .executive-summary {
            background: #ecf0f1;
            padding: 25px;
            border-radius: 8px;
            border-left: 5px solid #3498db;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .kpi-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .kpi-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        
        .insight-box {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .insight-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .data-table th {
            background: #2c3e50;
            color: white;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .recommendation {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
            margin: 10px 0;
        }
        
        .recommendation h5 {
            color: #27ae60;
            margin-bottom: 8px;
        }
        
        .alert {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        
        .critical {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        
        .download-section {
            background: #2c3e50;
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        
        .download-btn {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .download-btn:hover {
            background: #2980b9;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .chart-container h3 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .chart-container canvas {
            max-height: 300px !important;
        }
        
        .sql-code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        
        .sql-code::before {
            content: "SQL Query:";
            display: block;
            color: #3498db;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.8em;
        }

        .performance-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .matrix-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .matrix-card h4 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .matrix-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .matrix-subtitle {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        @media print {
            .download-section {
                display: none;
            }
            
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body id="artifacts-component-root-html">
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>Hospital Management System</h1>
            <div class="subtitle">Comprehensive Data Analysis &amp; Business Intelligence Report</div>
            <div class="author-info">
                <h3>Report Prepared By:</h3>
                <p><strong>Rakesh Kumar Gupta</strong></p>
                <p>Senior Data Analyst</p>
                <p>Date: August 2025</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Executive Summary -->
            <div class="section">
                <h2>Executive Summary</h2>
                <div class="executive-summary">
                    <p><strong>This comprehensive analysis of our hospital management system reveals critical insights across five key operational areas: appointments, billing, patient demographics, doctor performance, and treatment efficiency.</strong></p>
                    <br>
                    <p>Our analysis of 200 appointments, 200 billing records, 50 patients, 10 doctors, and 200 treatment records demonstrates both significant opportunities and operational challenges. While revenue performance shows positive trends with ₹509,844.36 total revenue generated, we face substantial operational inefficiencies with a combined 50.5% appointment failure rate (28.5% cancellations + 22.0% no-shows).</p>
                </div>
            </div>

            <!-- Key Performance Indicators -->
            <div class="section">
                <h2>Key Performance Indicators</h2>
                
                <!-- Revenue by Specialization Chart -->
                <div class="chart-container">
                    <h3>Revenue Distribution by Medical Specialization</h3>
                    <canvas id="revenueChart" width="522" height="300" style="display: block; box-sizing: border-box; height: 300px; width: 522px;"></canvas>
                </div>
                
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h4>Total Revenue</h4>
                        <div class="kpi-value">₹5,09,844</div>
                        <small>Across all specializations</small>
                    </div>
                    <div class="kpi-card">
                        <h4>Appointment Success Rate</h4>
                        <div class="kpi-value">49.5%</div>
                        <small>Major improvement area</small>
                    </div>
                    <div class="kpi-card">
                        <h4>Top Performing Branch</h4>
                        <div class="kpi-value">Eastside</div>
                        <small>₹94,874 revenue</small>
                    </div>
                    <div class="kpi-card">
                        <h4>Patient Registration</h4>
                        <div class="kpi-value">142 days</div>
                        <small>Avg. to first appointment</small>
                    </div>
                </div>
                
                <!-- Branch Performance Chart -->
                <div class="chart-container">
                    <h3>Hospital Branch Performance Comparison</h3>
                    <canvas id="branchChart" width="522" height="300" style="display: block; box-sizing: border-box; height: 300px; width: 522px;"></canvas>
                </div>
            </div>

            <!-- Technical Methodology -->
            <div class="section">
                <h2>Technical Methodology &amp; SQL Implementation</h2>
                <div class="executive-summary">
                    <p><strong>Data Processing Approach:</strong> This analysis leverages advanced SQL techniques including complex joins, window functions, conditional aggregation, and subqueries across five normalized tables (appointments, billing, doctors, patients, treatments).</p>
                    <br>
                    <p><strong>Database Schema:</strong> Fact tables (appointments, treatments, billing) connected via foreign keys to dimension tables (patients, doctors) enabling comprehensive business intelligence queries.</p>
                </div>
            </div>

            <!-- SQL Query Library -->
            <div class="section">
                <h2>SQL Query Library &amp; Implementation</h2>
                
                <div class="insight-box">
                    <div class="insight-title">Query 1: Revenue Analysis by Doctor Specialization</div>
                    <pre class="sql-code">SELECT d.specialization, SUM(b.amount) AS total_revenue
FROM billing b
INNER JOIN treatments t ON b.treatment_id = t.treatment_id
INNER JOIN appointments a ON t.appointment_id = a.appointment_id
INNER JOIN doctors d ON a.doctor_id = d.doctor_id
GROUP BY d.specialization
ORDER BY total_revenue DESC;</pre>
                    <p><strong>Technical Note:</strong> Multi-table join across 4 tables with aggregation to calculate revenue attribution by medical specialty.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 2: Top Revenue-Generating Patients</div>
                    <pre class="sql-code">SELECT p.first_name, p.last_name, SUM(b.amount) AS total_bill_amount
FROM billing b
INNER JOIN patients p ON b.patient_id = p.patient_id
GROUP BY p.first_name, p.last_name
ORDER BY total_bill_amount DESC
LIMIT 5;</pre>
                    <p><strong>Technical Note:</strong> Customer lifetime value calculation using GROUP BY aggregation with TOP-N analysis.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 3: Appointment Success Rate Analysis</div>
                    <pre class="sql-code">SELECT CAST(SUM(CASE WHEN status = 'Cancelled' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) AS cancellation_rate,
       CAST(SUM(CASE WHEN status = 'No-show' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) AS no_show_rate
FROM appointments;</pre>
                    <p><strong>Technical Note:</strong> Conditional aggregation using CASE statements for calculating percentage metrics with type casting for precision.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 4: Hospital Branch Performance Comparison</div>
                    <pre class="sql-code">SELECT d.hospital_branch, SUM(b.amount) AS total_revenue_completed_appts
FROM billing b
INNER JOIN treatments t ON b.treatment_id = t.treatment_id
INNER JOIN appointments a ON t.appointment_id = a.appointment_id
INNER JOIN doctors d ON a.doctor_id = d.doctor_id
WHERE a.status = 'Completed'
GROUP BY d.hospital_branch
ORDER BY total_revenue_completed_appts DESC;</pre>
                    <p><strong>Technical Note:</strong> Filtered aggregation with WHERE clause to analyze only successful appointments for accurate branch comparison.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 5: Treatment Cost Analysis</div>
                    <pre class="sql-code">SELECT treatment_type, AVG(cost) AS average_cost
FROM treatments
GROUP BY treatment_type
ORDER BY average_cost DESC;</pre>
                    <p><strong>Technical Note:</strong> Simple aggregation function for cost benchmarking across treatment categories.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 6: Monthly Revenue &amp; Appointment Trends</div>
                    <pre class="sql-code">SELECT STRFTIME('%Y-%m', a.appointment_date) AS month,
       COUNT(DISTINCT a.appointment_id) AS total_appointments,
       SUM(b.amount) AS total_revenue
FROM appointments a
INNER JOIN billing b ON a.patient_id = b.patient_id
GROUP BY month
ORDER BY month;</pre>
                    <p><strong>Technical Note:</strong> Time-series analysis using STRFTIME for date manipulation and DISTINCT count for accurate appointment counting.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 7: Advanced Patient Behavior Analysis</div>
                    <pre class="sql-code">WITH patient_visit_rank AS (
    SELECT patient_id,
           reason_for_visit,
           COUNT(*) AS visit_count,
           RANK() OVER (PARTITION BY patient_id ORDER BY COUNT(*) DESC) AS rnk
    FROM appointments
    GROUP BY patient_id, reason_for_visit
)
SELECT p.first_name, p.last_name
FROM patient_visit_rank pvr
INNER JOIN patients p ON pvr.patient_id = p.patient_id
WHERE pvr.rnk = 1 AND pvr.reason_for_visit = 'Consultation';</pre>
                    <p><strong>Technical Note:</strong> Common Table Expression (CTE) with window functions (RANK) for advanced patient segmentation analysis.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 8: Doctor Performance Benchmarking</div>
                    <pre class="sql-code">SELECT d.first_name, d.last_name, COUNT(a.appointment_id) AS num_appointments
FROM doctors d
INNER JOIN appointments a ON d.doctor_id = a.doctor_id
GROUP BY d.first_name, d.last_name
HAVING COUNT(a.appointment_id) &gt; (
    SELECT AVG(appointment_count)
    FROM (
        SELECT COUNT(appointment_id) AS appointment_count
        FROM appointments
        GROUP BY doctor_id
    ) AS avg_counts
)
ORDER BY num_appointments DESC;</pre>
                    <p><strong>Technical Note:</strong> Nested subquery with HAVING clause for performance comparison against calculated average.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 9: Insurance Provider Cost Analysis</div>
                    <pre class="sql-code">SELECT p.insurance_provider, SUM(t.cost) AS total_cost
FROM treatments t
INNER JOIN appointments a ON t.appointment_id = a.appointment_id
INNER JOIN patients p ON a.patient_id = p.patient_id
GROUP BY p.insurance_provider
ORDER BY total_cost DESC;</pre>
                    <p><strong>Technical Note:</strong> Three-table join for insurance cost attribution analysis.</p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Query 10: Patient Onboarding Efficiency Analysis</div>
                    <pre class="sql-code">SELECT p.gender, AVG(JULIANDAY(a.appointment_date) - JULIANDAY(p.registration_date)) AS avg_days_to_first_appointment
FROM appointments a
INNER JOIN patients p ON a.patient_id = p.patient_id
WHERE a.status = 'Completed' AND a.appointment_date = (
    SELECT MIN(appointment_date)
    FROM appointments
    WHERE patient_id = a.patient_id
)
GROUP BY p.gender;</pre>
                    <p><strong>Technical Note:</strong> Complex date arithmetic using JULIANDAY function with correlated subquery to identify first appointments per patient.</p>
                </div>
            </div>

            <!-- Critical Business Insights -->
            <div class="section">
                <h2>Critical Business Insights</h2>

                <div class="insight-box">
                    <div class="insight-title">1. Revenue Distribution by Medical Specialization</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Specialization</th>
                                <th>Total Revenue</th>
                                <th>Market Share</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Pediatrics</td>
                                <td>₹2,31,180</td>
                                <td>45.3%</td>
                            </tr>
                            <tr>
                                <td>Oncology</td>
                                <td>₹1,48,890</td>
                                <td>29.2%</td>
                            </tr>
                            <tr>
                                <td>Dermatology</td>
                                <td>₹1,19,774</td>
                                <td>23.5%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="recommendation">
                        <h5>Strategic Recommendation:</h5>
                        <p>Pediatrics generates nearly half of our total revenue. Consider expanding pediatric services and recruiting additional specialists to capitalize on this high-demand area.</p>
                    </div>
                </div>

                <div class="insight-box">
                    <div class="insight-title">2. Hospital Branch Performance Analysis</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Branch</th>
                                <th>Revenue from Completed Appointments</th>
                                <th>Performance Gap</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Eastside Clinic</td>
                                <td>₹94,874</td>
                                <td>Benchmark</td>
                            </tr>
                            <tr>
                                <td>Central Hospital</td>
                                <td>₹90,821</td>
                                <td>-4.3%</td>
                            </tr>
                            <tr>
                                <td>Westside Clinic</td>
                                <td>₹86,281</td>
                                <td>-9.1%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert critical">
                    <strong>Critical Alert:</strong> High appointment failure rates are severely impacting revenue potential. With 28.5% cancellations and 22.0% no-shows, we're losing approximately 50.5% of scheduled appointment revenue.
                </div>

                <div class="insight-box">
                    <div class="insight-title">3. Top Revenue-Generating Patients</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Patient Name</th>
                                <th>Total Bill Amount</th>
                                <th>Revenue Contribution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Jennifer Davis</td>
                                <td>₹10,006</td>
                                <td>2.0%</td>
                            </tr>
                            <tr>
                                <td>Charles Brown</td>
                                <td>₹9,912</td>
                                <td>1.9%</td>
                            </tr>
                            <tr>
                                <td>Laura White</td>
                                <td>₹9,134</td>
                                <td>1.8%</td>
                            </tr>
                            <tr>
                                <td>Laura Smith</td>
                                <td>₹8,713</td>
                                <td>1.7%</td>
                            </tr>
                            <tr>
                                <td>Jennifer Wilson</td>
                                <td>₹8,624</td>
                                <td>1.7%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="insight-box">
                    <div class="insight-title">4. Treatment Cost Analysis</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Treatment Type</th>
                                <th>Average Cost</th>
                                <th>Cost Efficiency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>X-Ray</td>
                                <td>₹3,624</td>
                                <td>Highest cost</td>
                            </tr>
                            <tr>
                                <td>Chemotherapy</td>
                                <td>₹3,108</td>
                                <td>High complexity</td>
                            </tr>
                            <tr>
                                <td>MRI</td>
                                <td>₹2,899</td>
                                <td>Premium diagnostic</td>
                            </tr>
                            <tr>
                                <td>Physiotherapy</td>
                                <td>₹2,587</td>
                                <td>Moderate cost</td>
                            </tr>
                            <tr>
                                <td>ECG</td>
                                <td>₹2,241</td>
                                <td>Most cost-effective</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="alert critical">
                    <strong>Payment Collection Crisis:</strong> ₹3,08,965 (60.5%) of total billed amount is either pending (₹1,94,513) or failed (₹1,14,452), representing a significant cash flow risk.
                </div>
            </div>

            <!-- Patient Demographics & Utilization -->
            <div class="section">
                <h2>Patient Demographics &amp; Service Utilization</h2>
                
                <!-- Visit Reasons Chart -->
                <div class="chart-container">
                    <h3>Most Frequent Reasons for Hospital Visits</h3>
                    <canvas id="visitReasonsChart" width="522" height="300" style="display: block; box-sizing: border-box; height: 300px; width: 522px;"></canvas>
                </div>
                
                <div class="insight-box">
                    <div class="insight-title">Visit Reasons Breakdown</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Reason for Visit</th>
                                <th>Number of Appointments</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Consultation</td>
                                <td>56</td>
                                <td>28%</td>
                            </tr>
                            <tr>
                                <td>Checkup</td>
                                <td>48</td>
                                <td>24%</td>
                            </tr>
                            <tr>
                                <td>Therapy</td>
                                <td>44</td>
                                <td>22%</td>
                            </tr>
                            <tr>
                                <td>Follow-up</td>
                                <td>30</td>
                                <td>15%</td>
                            </tr>
                            <tr>
                                <td>Emergency</td>
                                <td>22</td>
                                <td>11%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Payment Status Chart -->
                <div class="chart-container">
                    <h3>Payment Status Distribution - Critical Alert</h3>
                    <canvas id="paymentStatusChart" width="522" height="300" style="display: block; box-sizing: border-box; height: 300px; width: 522px;"></canvas>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h4>Gender Distribution</h4>
                        <div class="kpi-value">54% F</div>
                        <small>27 Female, 23 Male patients</small>
                    </div>
                    <div class="kpi-card">
                        <h4>Registration to First Visit</h4>
                        <div class="kpi-value">141.5</div>
                        <small>Average days</small>
                    </div>
                </div>
            </div>

            <!-- Strategic Recommendations -->
            <div class="section">
                <h2>Strategic Recommendations &amp; Action Plan</h2>

                <div class="recommendation">
                    <h5>1. Immediate Action: Appointment Management System Overhaul</h5>
                    <p><strong>Priority: CRITICAL</strong></p>
                    <ul>
                        <li>Implement automated SMS/email reminder system 48 hours and 24 hours before appointments</li>
                        <li>Introduce online rescheduling platform to reduce cancellations</li>
                        <li>Establish cancellation fees for repeated no-shows</li>
                        <li>Target: Reduce combined failure rate from 50.5% to below 25% within 6 months</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h5>2. Revenue Optimization Strategy</h5>
                    <p><strong>Priority: HIGH</strong></p>
                    <ul>
                        <li>Expand pediatrics department capacity - consider additional specialists and extended hours</li>
                        <li>Implement performance improvement plan for Westside Clinic based on Eastside best practices</li>
                        <li>Launch premium patient loyalty program targeting high-value customers (₹8,000+ annual spend)</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h5>3. Financial Collection Enhancement</h5>
                    <p><strong>Priority: CRITICAL</strong></p>
                    <ul>
                        <li>Implement digital payment gateway with multiple payment options</li>
                        <li>Establish dedicated follow-up team for pending payments (₹1,94,513 at risk)</li>
                        <li>Introduce payment plans for high-cost treatments</li>
                        <li>Target: Reduce pending/failed payments to below 30% of total billing</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h5>4. Operational Efficiency Improvements</h5>
                    <p><strong>Priority: MEDIUM</strong></p>
                    <ul>
                        <li>Reduce patient registration-to-first-appointment time from 141.5 days to under 30 days</li>
                        <li>Optimize treatment pricing based on cost analysis (review X-Ray pricing structure)</li>
                        <li>Implement cross-branch resource sharing to balance patient load</li>
                    </ul>
                </div>
            </div>

            <!-- Monthly Performance Analysis - Matrix Only -->
            <div class="section">
                <h2>Monthly Performance Analysis</h2>
                
                <div class="performance-matrix">
                    <div class="matrix-card">
                        <h4>January 2023</h4>
                        <div class="matrix-value">18</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹48,201</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                    
                    <div class="matrix-card">
                        <h4>February 2023</h4>
                        <div class="matrix-value">16</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹42,904</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                    
                    <div class="matrix-card">
                        <h4>March 2023</h4>
                        <div class="matrix-value">17</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹45,512</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                    
                    <div class="matrix-card">
                        <h4>April 2023</h4>
                        <div class="matrix-value">19</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹51,789</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                    
                    <div class="matrix-card">
                        <h4>May 2023</h4>
                        <div class="matrix-value">15</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹39,113</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                    
                    <div class="matrix-card">
                        <h4>June 2023</h4>
                        <div class="matrix-value">21</div>
                        <div class="matrix-subtitle">Appointments</div>
                        <div style="margin-top: 10px;">
                            <strong>₹58,451</strong><br>
                            <span class="matrix-subtitle">Revenue</span>
                        </div>
                    </div>
                </div>

                <div class="insight-box">
                    <div class="insight-title">Monthly Performance Key Insights</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Best Month</th>
                                <th>Worst Month</th>
                                <th>Average</th>
                                <th>Trend Analysis</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Total Appointments</td>
                                <td>June (21)</td>
                                <td>May (15)</td>
                                <td>17.7</td>
                                <td>Volatile with June peak</td>
                            </tr>
                            <tr>
                                <td>Total Revenue</td>
                                <td>June (₹58,451)</td>
                                <td>May (₹39,113)</td>
                                <td>₹47,662</td>
                                <td>Correlates with appointments</td>
                            </tr>
                            <tr>
                                <td>Revenue per Appointment</td>
                                <td>April (₹2,726)</td>
                                <td>May (₹2,608)</td>
                                <td>₹2,692</td>
                                <td>Relatively stable pricing</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Conclusion -->
            <div class="section">
                <h2>Conclusion &amp; Next Steps</h2>
                <div class="executive-summary">
                    <p><strong>Our hospital management system analysis reveals a tale of two realities:</strong> strong revenue generation potential coupled with significant operational inefficiencies that are constraining growth.</p>
                    <br>
                    <p>The data clearly shows that with a 50.5% appointment failure rate and over ₹3 lakh in pending/failed payments, we have immediate opportunities to increase revenue by 40-60% through operational improvements alone, without adding new services or capacity.</p>
                    <br>
                    <p><strong>Immediate priorities for the next 90 days:</strong></p>
                    <ol>
                        <li>Deploy appointment reminder and rescheduling system</li>
                        <li>Launch aggressive collection campaign for pending payments</li>
                        <li>Begin pediatrics capacity expansion planning</li>
                        <li>Implement Eastside Clinic best practices across all branches</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Download Section -->
        <div class="download-section">
            <h3>Report Actions</h3>
            <p>This report can be saved for future reference and sharing with stakeholders</p>
            <a href="#" class="download-btn" onclick="window.print()">Print Report</a>
            <a href="#" class="download-btn" onclick="downloadReport()">Save as HTML</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        function downloadReport() {
            // Create a blob with the HTML content
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            
            // Create download link
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Hospital_Management_Analysis_Report_Rakesh_Kumar_Gupta.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to KPI cards
            const kpiCards = document.querySelectorAll('.kpi-card');
            kpiCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.transition = 'transform 0.3s ease';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Add hover effects to matrix cards
            const matrixCards = document.querySelectorAll('.matrix-card');
            matrixCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px) scale(1.02)';
                    this.style.transition = 'transform 0.3s ease';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Initialize Charts
            initializeCharts();
        });

        function initializeCharts() {
            // Revenue by Specialization Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pediatrics', 'Oncology', 'Dermatology'],
                    datasets: [{
                        data: [231180, 148890, 119774],
                        backgroundColor: ['#3498db', '#e74c3c', '#f39c12'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ₹' + context.parsed.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Branch Performance Chart
            const branchCtx = document.getElementById('branchChart').getContext('2d');
            new Chart(branchCtx, {
                type: 'bar',
                data: {
                    labels: ['Eastside Clinic', 'Central Hospital', 'Westside Clinic'],
                    datasets: [{
                        label: 'Revenue (₹)',
                        data: [94874, 90821, 86281],
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c'],
                        borderColor: ['#2ecc71', '#f1c40f', '#c0392b'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString();
                                },
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Visit Reasons Chart
            const visitCtx = document.getElementById('visitReasonsChart').getContext('2d');
            new Chart(visitCtx, {
                type: 'pie',
                data: {
                    labels: ['Consultation', 'Checkup', 'Therapy', 'Follow-up', 'Emergency'],
                    datasets: [{
                        data: [56, 48, 44, 30, 22],
                        backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#e74c3c'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });

            // Payment Status Chart
            const paymentCtx = document.getElementById('paymentStatusChart').getContext('2d');
            new Chart(paymentCtx, {
                type: 'bar',
                data: {
                    labels: ['Paid', 'Pending', 'Failed'],
                    datasets: [{
                        label: 'Number of Bills',
                        data: [74, 71, 55],
                        backgroundColor: ['rgba(46, 204, 113, 0.8)', 'rgba(241, 196, 15, 0.8)', 'rgba(231, 76, 60, 0.8)'],
                        borderColor: ['#2ecc71', '#f1c40f', '#e74c3c'],
                        borderWidth: 2,
                        yAxisID: 'y'
                    }, {
                        label: 'Total Amount (₹)',
                        data: [200879, 194513, 114452],
                        backgroundColor: ['rgba(46, 204, 113, 0.3)', 'rgba(241, 196, 15, 0.3)', 'rgba(231, 76, 60, 0.3)'],
                        borderColor: ['#27ae60', '#f39c12', '#c0392b'],
                        borderWidth: 2,
                        type: 'line',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Number of Bills',
                                font: {
                                    size: 11
                                }
                            },
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Amount (₹)',
                                font: {
                                    size: 11
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString();
                                },
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>

</body></html>